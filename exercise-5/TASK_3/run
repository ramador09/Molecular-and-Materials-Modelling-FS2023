#!/bin/bash --login
#SBATCH -N 1
#SBATCH -n 4
#SBATCH --time=0:10:00
#SBATCH --job-name="task_3"
#SBATCH --mem-per-cpu=1024
#SBATCH --output=stdout.txt
#SBATCH --error=stderr.txt

module load intel/2022.1.2
module load quantum_espresso/7.1
#======START=====

a=5.43
alat=`echo "${a} / 0.529177" | bc -l`

cat >pw.in << EOF
 &control
    verbosity='high'
    calculation='scf'
    restart_mode='from_scratch'
    prefix='SI'
    pseudo_dir = './',
    outdir='./'
 /
 &system
    ibrav=2
    celldm(1)=${alat}
    nat=2,
    ntyp=1,
    ecutwfc = 30,
    occupations='smearing',
    degauss=0.001
 /
 &electrons
    conv_thr = 1.0e-8
    mixing_beta = 0.5
 /
 &ions
 /
ATOMIC_SPECIES
  Si  28.086  Si.pbe-mt_fhi.UPF
ATOMIC_POSITIONS  crystal
 Si 0.00 0.00 0.00
 Si 0.25 0.25 0.25
K_POINTS automatic
8 8 8 1 1 1
EOF

srun -n 4   pw.x -npools 2 <pw.in > si.out

cat >pwb.in << EOF2
 &control
    verbosity='high'
    calculation='bands'
    restart_mode='from_scratch'
    prefix='SI'
    pseudo_dir = './',
    outdir='./'
 /
 &system
    ibrav=2
    celldm(1)=${alat}
    nat=2,
    ntyp=1,
    ecutwfc = 30,
    occupations='smearing',
    degauss=0.001
 /
 &electrons
    conv_thr = 1.0e-8
    mixing_beta = 0.5
 /
 &ions
 /
ATOMIC_SPECIES
  Si  28.086  Si.pbe-mt_fhi.UPF
ATOMIC_POSITIONS  angstrom
 Si 0.00 0.00 0.00
 Si 0.25 0.25 0.25
K_POINTS crystal
 100
  0.5         0.5         0.5           1
  0.48888889  0.48888889  0.48888889    1
  0.47777778  0.47777778  0.47777778    1
  0.46666667  0.46666667  0.46666667    1
  0.45555556  0.45555556  0.45555556    1
  0.44444444  0.44444444  0.44444444    1
  0.43333333  0.43333333  0.43333333    1
  0.42222222  0.42222222  0.42222222    1
  0.41111111  0.41111111  0.41111111    1
  0.4         0.4         0.4           1
  0.38888889  0.38888889  0.38888889    1
  0.37777778  0.37777778  0.37777778    1
  0.36666667  0.36666667  0.36666667    1
  0.35555556  0.35555556  0.35555556    1
  0.34444444  0.34444444  0.34444444    1
  0.33333333  0.33333333  0.33333333    1
  0.32222222  0.32222222  0.32222222    1
  0.31111111  0.31111111  0.31111111    1
  0.3         0.3         0.3           1
  0.28888889  0.28888889  0.28888889    1
  0.27777778  0.27777778  0.27777778    1
  0.26666667  0.26666667  0.26666667    1
  0.25555556  0.25555556  0.25555556    1
  0.24444444  0.24444444  0.24444444    1
  0.23333333  0.23333333  0.23333333    1
  0.22222222  0.22222222  0.22222222    1
  0.21111111  0.21111111  0.21111111    1
  0.2         0.2         0.2           1
  0.18888889  0.18888889  0.18888889    1
  0.17777778  0.17777778  0.17777778    1
  0.16666667  0.16666667  0.16666667    1
  0.15555556  0.15555556  0.15555556    1
  0.14444444  0.14444444  0.14444444    1
  0.13333333  0.13333333  0.13333333    1
  0.12222222  0.12222222  0.12222222    1
  0.11111111  0.11111111  0.11111111    1
  0.1         0.1         0.1           1
  0.08888889  0.08888889  0.08888889    1
  0.07777778  0.07777778  0.07777778    1
  0.06666667  0.06666667  0.06666667    1
  0.05555556  0.05555556  0.05555556    1
  0.04444444  0.04444444  0.04444444    1
  0.03333333  0.03333333  0.03333333    1
  0.02222222  0.02222222  0.02222222    1
  0.01111111  0.01111111  0.01111111    1
  0.          0.          0.            1
  0.00925926  0.          0.00925926    1
  0.01851852  0.          0.01851852    1
  0.02777778  0.          0.02777778    1
  0.03703704  0.          0.03703704    1
  0.0462963   0.          0.0462963     1
  0.05555556  0.          0.05555556    1
  0.06481481  0.          0.06481481    1
  0.07407407  0.          0.07407407    1
  0.08333333  0.          0.08333333    1
  0.09259259  0.          0.09259259    1
  0.10185185  0.          0.10185185    1
  0.11111111  0.          0.11111111    1
  0.12037037  0.          0.12037037    1
  0.12962963  0.          0.12962963    1
  0.13888889  0.          0.13888889    1
  0.14814815  0.          0.14814815    1
  0.15740741  0.          0.15740741    1
  0.16666667  0.          0.16666667    1
  0.17592593  0.          0.17592593    1
  0.18518519  0.          0.18518519    1
  0.19444444  0.          0.19444444    1
  0.2037037   0.          0.2037037     1
  0.21296296  0.          0.21296296    1
  0.22222222  0.          0.22222222    1
  0.23148148  0.          0.23148148    1
  0.24074074  0.          0.24074074    1
  0.25        0.          0.25          1
  0.25925926  0.          0.25925926    1
  0.26851852  0.          0.26851852    1
  0.27777778  0.          0.27777778    1
  0.28703704  0.          0.28703704    1
  0.2962963   0.          0.2962963     1
  0.30555556  0.          0.30555556    1
  0.31481481  0.          0.31481481    1
  0.32407407  0.          0.32407407    1
  0.33333333  0.          0.33333333    1
  0.34259259  0.          0.34259259    1
  0.35185185  0.          0.35185185    1
  0.36111111  0.          0.36111111    1
  0.37037037  0.          0.37037037    1
  0.37962963  0.          0.37962963    1
  0.38888889  0.          0.38888889    1
  0.39814815  0.          0.39814815    1
  0.40740741  0.          0.40740741    1
  0.41666667  0.          0.41666667    1
  0.42592593  0.          0.42592593    1
  0.43518519  0.          0.43518519    1
  0.44444444  0.          0.44444444    1
  0.4537037   0.          0.4537037     1
  0.46296296  0.          0.46296296    1
  0.47222222  0.          0.47222222    1
  0.48148148  0.          0.48148148    1
  0.49074074  0.          0.49074074    1
  0.5         0.          0.5           1
EOF2
srun -n 4   pw.x -npools 2 <pwb.in > sibands.out
